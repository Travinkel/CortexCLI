# GitHub Issues

## üéâ Milestones

### [COMPLETED] Phase 0: ETL Pipeline Foundation (Weeks 1-2)

**Status:** ‚úÖ Complete (2025-12-21)

**Goal:** Infrastructure foundation without live learners

#### üìä Final Results

**Parser Validation:**
- ‚úÖ 33/33 files (100%) parsed successfully
- ‚úÖ 298 content chunks extracted
- ‚úÖ Coverage rate: 56.7% (exceeds 30% target by 89%!)
- ‚úÖ 421 atoms generated (exceeds 100 target by 321%!)

**Atoms Generated by Template Rule:**
- CLI Commands ‚Üí Parsons: 10
- Definitions ‚Üí Flashcards: 339
- Tables ‚Üí Matching: 0
- Numeric Examples ‚Üí Calculation: 71
- Comparisons ‚Üí Compare Atoms: 1

#### üìÅ Files Created

**1. Database Migrations (4 files)**
- `src/db/migrations/024_misconception_library.sql` - Catalog of 50+ common learning errors
- `src/db/migrations/025_atom_response_options.sql` - MCQ distractors with misconception tagging
- `src/db/migrations/026_learner_error_log.sql` - Comprehensive error tracking
- `src/db/migrations/027_psychometric_tracking.sql` - IRT & item analysis fields

**2. Atom Type Metadata (1 file)**
- `data/atom_type_metadata.json` - Complete metadata for 80 learning atom types organized into 12 categories with cognitive load indices, Bloom's levels, and psychometric parameters

**3. Multi-Format Parser (1 file)**
- `src/processing/course_chunker.py` - UniversalChunker handles:
  - CCNA hierarchical markdown
  - Moodle week-based courses
  - Q&A pairs
  - Curriculum tables
  - Free-form content

**4. Template Engine (1 file)**
- `src/content/generation/template_engine.py` - 5 deterministic generation rules:
  1. CLI Commands ‚Üí Parsons Problems
  2. Definitions ‚Üí Flashcards
  3. Tables ‚Üí Matching Atoms
  4. Numeric Examples ‚Üí Calculation Atoms
  5. Comparisons ‚Üí Comparison Atoms

**5. Misconception Seed Data (1 file)**
- `data/misconception_seed_data.sql` - 50 misconceptions across 5 domains:
  - Networking: 15 (collision domain confusion, subnet masking, etc.)
  - Programming: 15 (loop bounds, assignment vs equality, etc.)
  - Systems/OS: 10 (processes vs threads, malloc initialization, etc.)
  - Security: 5 (authentication vs authorization, encryption vs hashing)
  - Algorithms: 5 (Big-O misunderstanding, greedy optimization, etc.)

#### üéØ Key Features Implemented

1. **Format-Agnostic Parsing:** Auto-detects content format (CCNA, Moodle, Q&A, etc.) and delegates to specialized parsers
2. **Template-Based Generation:** Achieves 56.7% coverage with deterministic rules (zero LLM cost for these atoms)
3. **Misconception Tagging:** Database schema supports linking MCQ distractors to specific misconceptions for diagnostic feedback
4. **Psychometric Tracking:** IRT difficulty parameters, discrimination index, p-values for item quality analysis
5. **Quality Grading:** All generated atoms include quality scores (A+ to F) and confidence ratings

#### üí° Highlights

- **Zero-cost atom generation:** 421 atoms created without a single LLM call
- **Comprehensive coverage:** All 33 source files (27 CCNA + 6 courses) successfully parsed
- **Production-ready schema:** Backward compatible migrations with full psychometric support
- **Scientific foundation:** Misconceptions categorized by cognitive error type (overgeneralization, surface features, etc.)

---

## üìã Roadmap: DARPA Digital Tutor Implementation

**Vision:** Build a terminal-based adaptive learning system that rivals DARPA's Digital Tutor and Knewton's adaptive engine.

**Status:** Phase 0 complete, Phase 1 starting

**Last Updated:** 2025-12-21

---

## Phase 1: TUI Foundation (Weeks 1-2) - NEXT UP

**Goal:** Replace basic CLI with split-pane interactive interface

### [Epic] Phase 1: TUI Foundation

**Deliverable:** Working TUI that can render basic atoms (MCQ, Short Answer, Cloze) in split-pane layout.

#### Tasks

- [ ] **[P1-1] Install Textual Framework**
  - Add `textual` to dependencies
  - Set up hot reload for development
  - Create basic app skeleton
  - Test rendering on Windows/Linux/macOS

- [ ] **[P1-2] Implement Split-Pane Layouts**
  - Horizontal split (Theory over Practice)
  - Vertical split (Side-by-side)
  - 3-pane layout (Reference + Workspace + Feedback)
  - Full-screen immersive mode
  - Layout switching (keyboard shortcuts)

- [ ] **[P1-3] Create Atom Renderers**
  - MCQ Renderer - Radio buttons, distractor highlighting
  - Short Answer Renderer - Text input with fuzzy matching
  - Cloze Renderer - Fill-in-the-blank with context
  - Parsons Renderer - Drag-and-drop code blocks
  - Numeric Renderer - Number input with unit selection
  - Confidence Rating Widget - Likert scale (1-5)

- [ ] **[P1-4] Implement Keyboard Navigation**
  - Tab between panes
  - Arrow keys for selection
  - Enter to submit
  - `H` for hint
  - `S` to skip
  - `E` to explain
  - `Q` to quit session

---

## Phase 2: Interactive Study Mode (Weeks 3-4)

**Goal:** Transform from passive flashcard review to active guided practice

### [Epic] Phase 2: Interactive Study Mode

**Deliverable:** Full study session that guides learner through goal ‚Üí probe ‚Üí core ‚Üí stress ‚Üí consolidation with live code execution.

#### Tasks

- [ ] **[P2-1] Session Orchestration**
  - Goal Framing - Display session objectives
  - Rapid Probe - 1-2 calibration questions
  - Adaptive Core - Real-time difficulty adjustment
  - Stress Test - Transfer/edge case challenges
  - Consolidation - End-of-session recall

- [ ] **[P2-2] Live Code Execution**
  - Python Sandbox - Execute user code with timeout
  - Bash Sandbox - Safe command execution (whitelist)
  - SQL Sandbox - SQLite query execution
  - Unit Test Runner - Auto-grade code submissions
  - Performance Constraints - Big-O enforcement

- [ ] **[P2-3] CLI Simulation**
  - Terminal Emulator - Simulate Cisco/Linux CLI
  - Stateful Commands - Track exec vs config mode
  - Output Validation - Check `show` command results
  - Network Topology Sim - OSPF, EIGRP, VLANs

- [ ] **[P2-4] Session State Management**
  - Auto-save - Every 5 atoms or 2 minutes
  - Resume - Pick up where you left off
  - Progress Bar - Atoms completed / total
  - Time Tracking - Session duration, time per atom
  - Export Session - Save for analysis

---

## Phase 3: Intelligence Layer (Weeks 5-6)

**Goal:** Implement cognitive diagnosis and adaptive selection

### [Epic] Phase 3: Intelligence Layer

**Deliverable:** Fully adaptive system that diagnoses learner state and adjusts in real-time.

#### Tasks

- [ ] **[P3-1] Cognitive Load Detection**
  - Time-on-Task Tracking - Detect slow/fast responses
  - Retry Counter - Track attempts per atom
  - Latency Analysis - Fast wrong = guess, slow wrong = overload
  - Cognitive Load Index - Real-time session difficulty score
  - Adaptive Difficulty - Increase/decrease based on load

- [ ] **[P3-2] Confidence Mismatch Detection**
  - Pre-Answer Confidence - Capture before attempt
  - Post-Answer Confidence - Capture after attempt
  - Hypercorrection Trigger - High confidence + wrong = intervention
  - Calibration Tracking - Confidence vs accuracy over time
  - Metacognitive Feedback - "You tend to overestimate on X topics"

- [ ] **[P3-3] Enhanced Atom Selection**
  - Error History Integration - Boost atoms related to past errors
  - Interleaving Enforcement - Never same type twice
  - Atom Type Effectiveness - Track ROI per learner
  - Prerequisite-Aware Selection - Don't show before prereqs met
  - Transfer Testing - Inject novel scenarios periodically

- [ ] **[P3-4] Session Recording & Analysis**
  - Event Stream - Log every interaction (JSON Lines)
  - Error Topology Maps - Cluster similar errors
  - Cognitive Flow Graphs - Visualize learning trajectory
  - Struggle Zone Identification - Auto-detect weak areas
  - Export for Research - Anonymized data for analysis

---

## Phase 4: Enhanced Atom Types (Weeks 7-8)

**Goal:** Implement advanced atom types for expert-level assessment

### [Epic] Phase 4: Enhanced Atom Types

**Deliverable:** Full suite of 80+ atom types implemented and tested.

#### Tasks

- [ ] **[P4-1] Debugging Challenges**
  - Spot the Bug - Highlight incorrect line
  - Root Cause Analysis - Explain why it fails
  - Minimal Fix - Smallest change to correct
  - Error Message Interpretation - Decode compiler errors
  - Log Analysis - Diagnose from stack traces

- [ ] **[P4-2] Design & Architecture**
  - Trade-off Analysis - Compare approaches
  - Component Responsibility - "Which layer does X?"
  - Failure Mode Prediction - "What breaks if X fails?"
  - Scalability Reasoning - "How does this scale?"
  - Security Boundary ID - "Where should validation occur?"

- [ ] **[P4-3] System Simulation**
  - What Happens If - Scenario prediction
  - State Simulation - Step through execution
  - Failure Injection - "What if this service dies?"
  - Concurrency Reasoning - Race condition detection
  - Performance Impact - "How does X affect latency?"

- [ ] **[P4-4] Creative & Transfer**
  - Generate Example - "Give an example of X"
  - Generate Counterexample - "When does this NOT work?"
  - Create Analogy - "What is X like?"
  - Design Test Case - "How would you test this?"
  - Propose Alternative - "What's another way?"

---

## Phase 5: Greenlight Integration (Weeks 9-10)

**Goal:** Auto-generate remediation atoms from real coding struggles

### [Epic] Phase 5: Greenlight Integration

**Deliverable:** Seamless integration where coding errors automatically become learning atoms.

#### Tasks

- [ ] **[P5-1] Error Detection API**
  - Watch File System - Monitor test runs
  - Parse Test Failures - Extract error class
  - Classify Error - Syntax, logic, conceptual
  - Pattern Matching - Detect repeated mistakes
  - Confidence Inference - Time-to-fix = confidence proxy

- [ ] **[P5-2] Atom Generation**
  - Template System - Error ‚Üí Atom mapping
  - Distractor Engineering - Generate plausible wrong answers
  - Difficulty Calibration - Match current mastery level
  - Tag with Error Class - Link back to original failure
  - Priority Boost - High Z-Score for immediate review

- [ ] **[P5-3] Feedback Loop**
  - IDE Plugin Communication - Local API or file-based
  - Real-time Sync - Push atoms to Cortex-CLI queue
  - Progress Reporting - "You've mastered async/await!"
  - Decay Detection - "You haven't used regex in 3 weeks"
  - Proactive Review - "Quick refresh on X before coding"

---

## Phase 6: Right-Learning Integration (Weeks 11-12)

**Goal:** Bi-directional sync with web platform

### [Epic] Phase 6: Right-Learning Integration

**Deliverable:** Cortex-CLI as both standalone tool and Right-Learning client.

#### Tasks

- [ ] **[P6-1] API Client**
  - Authentication - JWT token management
  - Profile Sync - Download user mastery state
  - Atom Sync - Pull latest curriculum
  - Progress Upload - Push local study sessions
  - Conflict Resolution - Handle offline edits

- [ ] **[P6-2] Export/Import**
  - Full Export - Profile + due cards for offline
  - Selective Export - Specific courses/modules
  - Import with Merge - Combine offline progress
  - Validation - Verify data integrity
  - Rollback - Undo bad imports

- [ ] **[P6-3] Content Pipeline**
  - Validate - Check atom quality before upload
  - Deduplicate - Semantic similarity matching
  - Enrich - Add embeddings, prerequisites
  - Ingest - Bulk upload to Right-Learning
  - CI/CD Integration - Run in GitHub Actions

---

## Phase 7: Polish & Launch (Weeks 13-14)

**Goal:** Production-ready release

### [Epic] Phase 7: Polish & Launch

**Deliverable:** v2.0 release with full DARPA Digital Tutor feature set.

#### Tasks

- [ ] **[P7-1] Performance Optimization**
  - Database Indexing - Query optimization
  - Caching - Redis for frequent queries
  - Lazy Loading - Load atoms on demand
  - Background Jobs - Async embedding generation
  - Profiling - Identify bottlenecks

- [ ] **[P7-2] User Experience**
  - Onboarding Tutorial - First-time user guide
  - Keyboard Shortcuts Help - `?` key overlay
  - Theme Support - Light/dark/custom
  - Accessibility - Screen reader support
  - Error Messages - User-friendly, actionable

- [ ] **[P7-3] Documentation**
  - User Guide - Getting started, workflows
  - API Documentation - OpenAPI spec
  - Architecture Diagrams - System overview
  - Video Tutorials - YouTube walkthroughs
  - Scientific FAQ - "Why these features?"

- [ ] **[P7-4] Testing & QA**
  - Unit Tests - 80%+ coverage
  - Integration Tests - End-to-end scenarios
  - Performance Tests - Load testing
  - User Acceptance - Beta tester feedback
  - Security Audit - Code review, dependency scan

---

## üìä Success Metrics

### Learning Effectiveness
- **Retention Rate:** 90%+ at 30 days (vs 70% baseline)
- **Transfer Success:** 75%+ on novel scenarios
- **Mastery Velocity:** 2x faster than passive study
- **Confidence Calibration:** <10% mismatch (confidence vs accuracy)

### User Experience
- **Session Completion:** 85%+ finish rate
- **Daily Active Users:** 60%+ return next day
- **Net Promoter Score:** >50
- **Time to Mastery:** 50% reduction vs traditional methods

### Technical Performance
- **Latency:** <100ms atom rendering
- **Uptime:** 99.9% API availability
- **Data Sync:** <5 sec round-trip
- **Offline Support:** Full functionality without network

---

## üîÆ Future Enhancements (v3.0+)

### Advanced Features
- [ ] Spaced Repetition Optimizer - Auto-tune FSRS parameters
- [ ] Peer Learning - Collaborative study sessions
- [ ] Instructor Dashboard - Class-wide analytics
- [ ] Mobile Companion - iOS/Android app
- [ ] Voice Interface - Hands-free study mode

### Content Expansion
- [ ] More Domains - Math, Physics, Languages
- [ ] Video Integration - Annotated video lessons
- [ ] Interactive Diagrams - Zoomable, clickable
- [ ] AR/VR Experiments - 3D visualization
- [ ] Game-ification - Leaderboards, achievements

### Research Features
- [ ] A/B Testing Framework - Test learning strategies
- [ ] Academic Partnerships - Publish research
- [ ] Open Dataset - Anonymized learning data
- [ ] ML Model Training - Personalized difficulty prediction
- [ ] Neuroscience Integration - EEG/fMRI correlation

---

## Refactoring

### [Refactor] Decouple Anki Field Mappings from Client Logic
**File:** `src/anki/anki_client.py`
**Description:** The `AnkiClient` currently hardcodes field names (e.g., "Card ID", "Front", "Back", "concept_id") and assumes a specific note type structure (likely "LearningOS-v2"). This makes the client brittle and unusable for users with different Anki note templates.
**Action:**
- Extract field mappings into `config.py` or a separate mapping configuration.
- Update `_map_note_to_card` and `upsert_card` to use these configurable mappings instead of hardcoded strings.

### [Refactor] Remove Lazy Imports in API Routers
**File:** `src/api/routers/*.py`
**Description:** Multiple routers (`sync_router.py`, `quiz_router.py`, etc.) import dependencies (like `NotionClient`, `SyncService`, `QuizQuestionAnalyzer`, `sqlalchemy` models) inside function bodies. While this avoids circular dependencies at module level, it hides import errors until runtime and complicates testing.
**Action:**
- Move imports to the top level where possible.
- If circular dependencies exist, resolve them using dependency injection or by restructuring the modules (e.g., moving models to a shared module).

### [Refactor] Centralize Grade Logic
**File:** `src/api/routers/quiz_router.py`
**Description:** The `list_questions` endpoint contains hardcoded logic for grade values (`{"A": 5, "B": 4, ...}`). This logic is duplicated or implicitly assumed in other parts of the system (like `MasteryCalculator`).
**Action:**
- Move this logic to a shared constant or Enum in `src/core/mastery.py` or `src/quiz/constants.py`.
- Use the shared definition in the router.

### [Refactor] ‚úÖ Generalize Content Chunker (COMPLETED)
**File:** `src/processing/chunker.py`
**Description:** The `CCNAChunker` is highly coupled to specific CCNA content formats (regex patterns for Module 1, 4, 10, etc.). It should be renamed or refactored to allow for pluggable parsing strategies if other content types are to be supported.
**Action:**
- ‚úÖ Created `UniversalChunker` with format auto-detection
- ‚úÖ Supports CCNA, Moodle, Q&A, curriculum tables, and free-form content
- ‚úÖ Extensible architecture with `FormatParser` protocol

### [Refactor] Unify Configuration Management
**File:** `src/core/modes.py` vs `config.py`
**Description:** The CLI uses `CortexCliConfig` (loading from `config.toml`) while the API uses `Settings` (loading from `.env`). This dual configuration system is confusing and prone to inconsistencies.
**Action:**
- Merge configuration into a single source of truth.
- Prefer `.env` for secrets and environment-specific settings, and `config.toml` for user preferences, but access them through a unified interface.

## Security & Stability

### [Security] Safeguard Bulk Deck Deletion
**File:** `src/anki/anki_client.py`
**Description:** The `delete_deck_cards` method deletes *all* cards in a specified deck without any internal safeguards or "force" flags. An accidental call could lead to significant data loss.
**Action:**
- Add a `force=False` parameter to the method.
- Require `force=True` to proceed with deletion.
- Log a high-severity warning before execution.

### [Stability] Improve Exception Handling Granularity
**File:** `src/api/routers/sync_router.py`, `src/anki/anki_client.py`
**Description:** Several areas use broad `except Exception as e` clauses. This can mask specific errors (like `KeyboardInterrupt` or system exits) and makes debugging difficult.
**Action:**
- Replace broad exceptions with specific ones (e.g., `requests.RequestException`, `HTTPException`, `SQLAlchemyError`) where the failure mode is known.
- Keep broad exceptions only at the top-level entry points (like API route handlers) as a last resort, but ensure full stack traces are logged.

## Features

### [Feature] Expose Anki Sync via API
**File:** `src/api/routers/sync_router.py`
**Description:** The `sync_router.py` docstring notes that Anki push/pull operations are currently CLI-only. For a complete headless operation or UI integration, these should be exposed via the API.
**Action:**
- Implement `POST /api/sync/anki/push` and `POST /api/sync/anki/pull` endpoints.
- Reuse the logic from the CLI commands, likely by refactoring the core logic into a shared service if not already done.

### [Feature] Configurable Anki Note Type for Cloze
**File:** `src/anki/anki_client.py`
**Description:** The `upsert_card` method has logic to detect cloze deletions but warns if the note type doesn't seem to support it.
**Action:**
- Allow configuring a specific "Cloze Note Type" in settings, separate from the standard "Basic Note Type".
- Automatically switch to the cloze note type when `{{c` patterns are detected in the front text.

### [Feature] Implement CLI Import and Config Commands
**File:** `src/cli/cortex_cli.py`
**Description:** The `import` and `config --set` commands are currently stubs with no implementation.
**Action:**
- Implement `import_data` logic to read the export file and upload via `PlatformClient`.
- Implement `config` setting logic to update the local configuration (e.g., `.env` file).

### [Feature] Implement Mode Strategies
**File:** `src/core/modes.py`
**Description:** `ApiModeStrategy` and `OfflineModeStrategy` contain stub methods (e.g., `get_due_atoms` returns empty list).
**Action:**
- Implement the actual logic for fetching atoms and recording reviews in both API and Offline modes.
- Delegate to `PlatformClient` for API mode and a local database service for Offline mode.

## Bugs

### [Bug] Unused Diversity Weights in Question Selection
**File:** `src/quiz/quiz_pool_manager.py`
**Description:** The `select_diverse_questions` method accepts a `diversity_weights` argument but completely ignores it, implementing a simple round-robin selection strategy instead.
**Action:**
- Implement the weighted selection logic using the provided weights.
- Or remove the argument if the round-robin strategy is intended.

### [Bug] Inconsistent Seeding Logic
**File:** `src/quiz/quiz_pool_manager.py`
**Description:** Seeding logic is split between `_create_seed` and manual `random.seed` calls. `select_questions` skips seeding if `seed` is None, but `select_questions_for_quiz` constructs a string seed, leading to potential inconsistencies in reproducibility.
**Action:**
- Centralize all RNG operations to a helper method.
- Ensure consistent seed handling across all selection methods.

### [Bug] Hardcoded API URL in Reachability Check
**File:** `src/core/modes.py`
**Description:** `_check_api_reachable` hardcodes `api.rightlearning.io` instead of using the configured `base_url`.
**Action:**
- Update the check to parse and use `self.config.api.base_url`.
